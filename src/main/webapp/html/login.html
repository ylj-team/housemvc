<html>
<script language="JavaScript" type="text/javascript" src="./js/jsbn/jsbn.js"></script>
<script language="JavaScript" type="text/javascript" src="./js/jsbn/prng4.js"></script>
<script language="JavaScript" type="text/javascript" src="./js/jsbn/rng.js"></script>
<script language="JavaScript" type="text/javascript" src="./js/jsbn/rsa.js"></script>
<script language="JavaScript" type="text/javascript" src="./js/jsbn/base64.js"></script>

<script language="JavaScript" type="text/javascript" src="./js/security/encryption.js"></script>


<script language="JavaScript">



function GetQueryString(name)
{	
	var svalue = window.location.search.match(new RegExp("[\?\&]" + name + "=([^\&]*)(\&?)","i"));
	return svalue ? svalue[1] : svalue;

}


	
	function do_encrypt_input() {
		
		//alert("do_encrypt_input()");
		console.log("do_encrypt_input()");

		var accountCipherText = encrypt(document.login_input.account.value);
		var passwdCipherText = encrypt(document.login_input.passwd.value);

		console.log(document.login_input.account.value+"=>"+accountCipherText);
		console.log(document.login_input.passwd.value+"=>"+passwdCipherText);
	
		document.login_input.account.value=accountCipherText;
		document.login_input.passwd.value=passwdCipherText;
		
		//
		var nextUrl=GetQueryString("nextUrl");
	
		if (nextUrl === null)
		{
			console.log("nextUrl===null");		
		}else{
			document.login_input.nextUrl.value=nextUrl;
		}
		
		console.log(document.login_input.passwd.value+"=>"+nextUrl);
		
		
		//alert("alert ,wait to jump");
		
		return false;
	}
	
	function do_init() {
		
		//display message 
		var message=GetQueryString("message");	
		
		if (message === null)
		{
			console.log("message===null");		
			
		}else{
			//console.log("window.location.search="+window.location.search);		
			//console.log(decodeURI(window.location.search));		
			
			console.log("encodedMessage="+message);
			var decodedMessage=decodeURIComponent(message);
			console.log("decodedMessage="+decodedMessage);
			
			var element=document.getElementById("message");					
			element.innerHTML="<font color='#FF0000' > =>"+decodedMessage+" </font>";
			
		}
	}
</script>

<head>
<meta charset="UTF-8">
<title>HTML5的标题</title>
</head>

 <body onLoad='do_init();'>  

	<form name="login_input"  action="./do_login" method="post" onsubmit="do_encrypt_input()">
		<p>
			account: <input type="text" name="account" />
		</p>
		<p>
			passwd : <input type="password" name="passwd" />
		</p>
		<p hidden >
			nextUrl: <input type="text" name=nextUrl />
		</p>
		
		<input type="submit" value="Submit"   />
		
		<!--  <input hidden type="button" value="encrypt" onclick="do_encrypt_input()" /> -->
		
		<p id="message" >
			
		</p>
		
	</form>

	<p hidden>jump to "login_jstl"</p>


</body>
</html>
